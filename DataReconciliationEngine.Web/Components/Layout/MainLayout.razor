@inherits LayoutComponentBase
@using DataReconciliationEngine.Web.Theme

<MudThemeProvider Theme="AppTheme.Instance" @bind-IsDarkMode="_isDarkMode" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    @* ── Top App Bar ──────────────────────────────────────── *@
    <MudAppBar Elevation="2" Dense="true" Fixed="true">
        <MudIconButton Icon="@Icons.Material.Filled.Menu"
                       Color="Color.Inherit"
                       Edge="Edge.Start"
                       OnClick="ToggleDrawer"
                       Title="Toggle navigation" />

        @* App identity *@
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2" Class="ml-2">
            <MudIcon Icon="@Icons.Material.Filled.CompareArrows" Size="Size.Medium" />
            <MudStack Spacing="0">
                <MudText Typo="Typo.subtitle1" Style="line-height: 1.2; font-weight: 600;">
                    Data Reconciliation
                </MudText>
                <MudText Typo="Typo.caption" Style="line-height: 1; opacity: 0.7;">
                    Engine v1.0
                </MudText>
            </MudStack>
        </MudStack>

        <MudSpacer />

        @* Environment badge *@
        <MudChip T="string"
                 Size="Size.Small"
                 Variant="Variant.Outlined"
                 Color="Color.Warning"
                 Style="color: white; border-color: rgba(255,255,255,0.5);"
                 Class="mr-2">
            DEV
        </MudChip>

        @* Dark mode toggle *@
        <MudTooltip Text="@(_isDarkMode ? "Switch to Light Mode" : "Switch to Dark Mode")">
            <MudIconButton Icon="@(_isDarkMode? Icons.Material.Filled.LightMode : Icons.Material.Filled.DarkMode)"
                           Color="Color.Inherit"
                           OnClick="ToggleDarkMode" />
        </MudTooltip>
    </MudAppBar>

    @* ── Side Drawer ──────────────────────────────────────── *@
    <MudDrawer @bind-Open="_drawerOpen"
               Elevation="0"
               Variant="DrawerVariant.Mini"
               ClipMode="DrawerClipMode.Always"
               Class="drawer-border">
        <NavMenu DrawerOpen="_drawerOpen" />
    </MudDrawer>

    @* ── Main Content ─────────────────────────────────────── *@
    <MudMainContent Style="min-height: 100vh; padding-left: 16px; padding-right: 16px; padding-bottom: 16px;">
        <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="pt-6">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@code {
    private bool _drawerOpen = true;
    private bool _isDarkMode;

    private void ToggleDrawer() => _drawerOpen = !_drawerOpen;
    private void ToggleDarkMode() => _isDarkMode = !_isDarkMode;
}